<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>期刊分区查询系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#c41230',
                        secondary: '#1a3a6e',
                        accent: '#f8f9fa',
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- 标题区域 -->
        <div class="glass-effect rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-secondary">期刊分区查询系统</h1>
                    <p class="text-gray-600 mt-2">查询SCI期刊的JCR分区和中科院分区信息</p>
                </div>
                <img src="https://unpkg.com/lucide-static@latest/icons/book-open.svg" class="w-12 h-12 text-primary" alt="Logo">
            </div>
        </div>

        <!-- 搜索和筛选区域 -->
        <div class="glass-effect rounded-xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 刊名搜索 -->
                <div class="relative">
                    <label for="journal-name" class="block text-sm font-medium text-gray-700 mb-2">期刊名称</label>
                    <div class="relative">
                        <input type="text" id="journal-name" placeholder="输入期刊名称进行搜索..." 
                            class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                        <img src="https://unpkg.com/lucide-static@latest/icons/search.svg" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" alt="搜索">
                    </div>
                </div>

                <!-- JCR分区筛选 -->
                <div>
                    <label for="jcr-filter" class="block text-sm font-medium text-gray-700 mb-2">JCR分区</label>
                    <div class="relative">
                        <select id="jcr-filter" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition appearance-none">
                            <option value="">全部</option>
                            <option value="Q1">Q1</option>
                            <option value="Q2">Q2</option>
                            <option value="Q3">Q3</option>
                            <option value="Q4">Q4</option>
                        </select>
                        <img src="https://unpkg.com/lucide-static@latest/icons/filter.svg" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" alt="筛选">
                        <img src="https://unpkg.com/lucide-static@latest/icons/chevron-down.svg" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" alt="下拉">
                    </div>
                </div>

                <!-- 中科院分区筛选 -->
                <div>
                    <label for="cas-filter" class="block text-sm font-medium text-gray-700 mb-2">中科院分区</label>
                    <div class="relative">
                        <select id="cas-filter" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition appearance-none">
                            <option value="">全部</option>
                            <option value="1区">1区</option>
                            <option value="2区">2区</option>
                            <option value="3区">3区</option>
                            <option value="4区">4区</option>
                        </select>
                        <img src="https://unpkg.com/lucide-static@latest/icons/filter.svg" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" alt="筛选">
                        <img src="https://unpkg.com/lucide-static@latest/icons/chevron-down.svg" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" alt="下拉">
                    </div>
                </div>
            </div>

            <div class="mt-6 flex justify-end">
                <button id="search-btn" class="bg-primary hover:bg-red-700 text-white px-6 py-2 rounded-lg flex items-center transition-all shadow-md hover:shadow-lg">
                    <img src="https://unpkg.com/lucide-static@latest/icons/search.svg" class="w-5 h-5 mr-2" alt="搜索">
                    查询
                </button>
            </div>
        </div>

        <!-- 数据加载提示 -->
        <div id="loading-indicator" class="glass-effect rounded-xl p-6 mb-8 flex flex-col items-center justify-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"></div>
            <p class="text-gray-500 text-lg">正在加载期刊数据...</p>
            <p class="text-gray-400 text-sm mt-2">请稍候</p>
        </div>

        <!-- 结果展示区域 -->
        <div id="results-container" class="glass-effect rounded-xl p-6 overflow-hidden hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-secondary">查询结果</h2>
                <div class="flex items-center text-gray-600">
                    <img src="https://unpkg.com/lucide-static@latest/icons/info.svg" class="w-5 h-5 mr-2" alt="信息">
                    <span id="result-count">共找到 <span class="font-bold text-primary">0</span> 条记录</span>
                </div>
            </div>

            <div class="overflow-x-auto" style="max-height: 60vh;">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">刊名</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">收录</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">2023IF</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">JCR分区</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">中科院分区</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="results-body">
                        <!-- 结果将在这里动态生成 -->
                    </tbody>
                </table>
            </div>

            <!-- 空结果提示 -->
            <div id="no-results" class="hidden flex flex-col items-center justify-center py-12">
                <img src="https://unpkg.com/lucide-static@latest/icons/search-x.svg" class="w-16 h-16 text-gray-300 mb-4" alt="无结果">
                <p class="text-gray-500 text-lg">未找到匹配的期刊</p>
                <p class="text-gray-400 text-sm mt-2">请尝试调整搜索条件</p>
            </div>
        </div>

        <!-- 页脚 -->
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>© 2025 期刊分区查询系统 | 背景图片来源: Unsplash</p>
        </div>
    </div>

    <script>
        // 全局变量存储期刊数据
        let journalData = [];
        
        // 页面加载完成后加载数据
        document.addEventListener('DOMContentLoaded', function() {
            // 尝试从CSV加载，如果失败则使用内置数据
            loadData();
        });

        // 加载数据（先尝试CSV，失败则使用内置数据）
        function loadData() {
            // 显示加载状态
            document.getElementById('loading-indicator').classList.remove('hidden');
            document.getElementById('results-container').classList.add('hidden');
            
            // 尝试加载CSV
            fetch('Q.csv?t=' + new Date().getTime(), {
                method: 'GET',
                headers: {
                    'Cache-Control': 'no-cache'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`无法加载期刊数据文件: ${response.status} ${response.statusText}`);
                }
                return response.text();
            })
            .then(csvText => {
                if (csvText.length === 0) {
                    throw new Error("CSV文件内容为空");
                }
                
                // 尝试检测CSV文件的分隔符
                const firstLine = csvText.split('\n')[0];
                const separator = detectSeparator(firstLine);
                
                // 解析CSV数据
                journalData = parseCsvData(csvText, separator);
                
                if (journalData.length === 0) {
                    throw new Error("解析CSV数据后没有有效记录");
                }
                
                console.log("成功从CSV加载了", journalData.length, "条记录");
                
                // 隐藏加载指示器，显示结果容器
                document.getElementById('loading-indicator').classList.add('hidden');
                document.getElementById('results-container').classList.remove('hidden');
                
                // 初始加载所有数据
                filterJournals();
            })
            .catch(error => {
                console.warn('加载CSV数据出错，将使用内置数据:', error);
                
                // 使用内置数据
                useBuiltinData();
            });
        }
        
        // 使用内置数据
        function useBuiltinData() {
            // 使用内置的期刊数据
            journalData = [
                { id: 1, name: "Annual Review of Psychology", source: "SSCI", impact: 23.6, jcr: "Q1", cas: "1区" },
                { id: 2, name: "TRENDS IN COGNITIVE SCIENCES", source: "SSCI", impact: 16.7, jcr: "Q1", cas: "1区" },
                { id: 3, name: "Nature Reviews Psychology", source: "ESCI", impact: 16.8, jcr: "Q1", cas: "1区" },
                { id: 4, name: "Nature Human Behaviour", source: "SSCI", impact: 21.4, jcr: "Q1", cas: "1区" },
                { id: 5, name: "Annual Review of Clinical Psychology", source: "SSCI", impact: 17.8, jcr: "Q1", cas: "1区" },
                { id: 6, name: "Social Issues and Policy Review", source: "SSCI", impact: 7.2, jcr: "Q1", cas: "1区" },
                { id: 7, name: "Psychological Bulletin", source: "SSCI", impact: 17.1, jcr: "Q1", cas: "1区" },
                { id: 8, name: "Journal of Personality and Social Psychology", source: "SSCI", impact: 8.5, jcr: "Q1", cas: "1区" },
                { id: 9, name: "Psychological Methods", source: "SSCI", impact: 10.2, jcr: "Q1", cas: "2区" },
                { id: 10, name: "Journal of Experimental Psychology: General", source: "SSCI", impact: 5.4, jcr: "Q1", cas: "2区" },
                { id: 11, name: "Psychological Science", source: "SSCI", impact: 6.5, jcr: "Q1", cas: "2区" },
                { id: 12, name: "Journal of Abnormal Psychology", source: "SSCI", impact: 5.2, jcr: "Q2", cas: "2区" },
                { id: 13, name: "Journal of Educational Psychology", source: "SSCI", impact: 5.0, jcr: "Q2", cas: "2区" },
                { id: 14, name: "Developmental Psychology", source: "SSCI", impact: 4.8, jcr: "Q2", cas: "2区" },
                { id: 15, name: "Journal of Applied Psychology", source: "SSCI", impact: 7.4, jcr: "Q1", cas: "2区" },
                { id: 16, name: "Health Psychology", source: "SSCI", impact: 4.2, jcr: "Q2", cas: "3区" },
                { id: 17, name: "Journal of Experimental Social Psychology", source: "SSCI", impact: 3.8, jcr: "Q2", cas: "3区" },
                { id: 18, name: "Cognition and Emotion", source: "SSCI", impact: 2.9, jcr: "Q3", cas: "3区" },
                { id: 19, name: "Journal of Research in Personality", source: "SSCI", impact: 3.1, jcr: "Q3", cas: "3区" },
                { id: 20, name: "Psychology of Addictive Behaviors", source: "SSCI", impact: 3.0, jcr: "Q3", cas: "4区" },
                { id: 21, name: "Journal of Cross-Cultural Psychology", source: "SSCI", impact: 2.2, jcr: "Q4", cas: "4区" },
                { id: 22, name: "Journal of Social Psychology", source: "SSCI", impact: 1.8, jcr: "Q4", cas: "4区" },
                { id: 23, name: "Child Development", source: "SSCI", impact: 5.7, jcr: "Q1", cas: "2区" },
                { id: 24, name: "Child Abuse & Neglect", source: "SSCI", impact: 3.6, jcr: "Q2", cas: "3区" },
                { id: 25, name: "Journal of Child Psychology and Psychiatry", source: "SSCI", impact: 8.2, jcr: "Q1", cas: "1区" }
            ];
            
            console.log("使用内置数据，共", journalData.length, "条记录");
            
            // 隐藏加载指示器，显示结果容器
            document.getElementById('loading-indicator').classList.add('hidden');
            document.getElementById('results-container').classList.remove('hidden');
            
            // 初始加载所有数据
            filterJournals();
        }

        // 检测CSV文件的分隔符
        function detectSeparator(line) {
            const separators = [',', ';', '\t'];
            let maxCount = 0;
            let bestSeparator = ','; // 默认使用逗号
            
            for (const sep of separators) {
                const count = (line.match(new RegExp(sep, 'g')) || []).length;
                if (count > maxCount) {
                    maxCount = count;
                    bestSeparator = sep;
                }
            }
            
            return bestSeparator;
        }

        // 解析CSV数据
        function parseCsvData(csvText, separator = ',') {
            try {
                // 按行分割CSV文本
                const lines = csvText.split(/\r?\n/);
                console.log("CSV行数:", lines.length);
                
                if (lines.length <= 1) {
                    console.error("CSV文件格式不正确，行数不足");
                    return [];
                }
                
                // 获取标题行（第一行）
                const headers = parseCSVLine(lines[0], separator);
                console.log("CSV标题:", headers);
                
                if (headers.length === 0) {
                    console.error("无法解析CSV标题行");
                    return [];
                }
                
                // 解析数据行
                const result = [];
                for (let i = 1; i < lines.length; i++) {
                    // 跳过空行
                    if (!lines[i].trim()) continue;
                    
                    const values = parseCSVLine(lines[i], separator);
                    
                    // 确保值的数量与标题数量一致
                    if (values.length === headers.length) {
                        const entry = {};
                        
                        // 将每个值与对应的标题关联
                        headers.forEach((header, index) => {
                            entry[header] = values[index];
                        });
                        
                        result.push(entry);
                    } else {
                        console.warn(`第${i+1}行的值数量(${values.length})与标题数量(${headers.length})不匹配，已跳过`);
                    }
                }
                
                // 处理数据并格式化
                return result.map((item, index) => {
                    return {
                        id: index + 1,
                        name: item['期刊名称'] || item['Journal Name'] || '',
                        source: item['收录类型'] || item['Source'] || '',
                        impact: item['影响因子'] || item['Impact Factor'] || 0,
                        jcr: item['JCR分区'] || '',
                        cas: item['中科院分区'] || item['CAS'] || ''
                    };
                });
            } catch (error) {
                console.error("解析CSV数据时出错:", error);
                return [];
            }
        }
        
        // 解析CSV行，处理引号内的逗号
        function parseCSVLine(line, separator = ',') {
            if (!line || line.trim() === '') return [];
            
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"' && (i === 0 || line[i-1] !== '\\')) {
                    inQuotes = !inQuotes;
                } else if (char === separator && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // 添加最后一个字段
            if (current || result.length > 0) {
                result.push(current.trim());
            }
            
            // 清理引号
            return result.map(value => {
                if (value.startsWith('"') && value.endsWith('"')) {
                    return value.substring(1, value.length - 1);
                }
                return value;
            });
        }

        // 搜索和筛选功能
        document.getElementById('search-btn').addEventListener('click', filterJournals);
        document.getElementById('journal-name').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                filterJournals();
            }
        });

        function filterJournals() {
            const nameQuery = document.getElementById('journal-name').value.toLowerCase();
            const jcrFilter = document.getElementById('jcr-filter').value;
            const casFilter = document.getElementById('cas-filter').value;
            
            const filteredData = journalData.filter(journal => {
                // 模糊查询期刊名称
                const nameMatch = journal.name.toLowerCase().includes(nameQuery);
                const jcrMatch = jcrFilter ? journal.jcr === jcrFilter : true;
                const casMatch = casFilter ? journal.cas === casFilter : true;
                
                return nameMatch && jcrMatch && casMatch;
            });
            
            renderResults(filteredData);
        }

        function renderResults(data) {
            const tableBody = document.getElementById('results-body');
            const noResults = document.getElementById('no-results');
            const resultCount = document.getElementById('result-count');
            
            // 更新结果计数
            resultCount.innerHTML = `共找到 <span class="font-bold text-primary">${data.length}</span> 条记录`;
            
            if (data.length === 0) {
                tableBody.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            let html = '';
            data.forEach((journal, index) => {
                html += `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${journal.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${journal.source}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${journal.impact}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getJcrColor(journal.jcr)}">${journal.jcr}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getCasColor(journal.cas)}">${journal.cas}</span>
                    </td>
                </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function getJcrColor(jcr) {
            switch(jcr) {
                case 'Q1': return 'bg-green-100 text-green-800';
                case 'Q2': return 'bg-blue-100 text-blue-800';
                case 'Q3': return 'bg-yellow-100 text-yellow-800';
                case 'Q4': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getCasColor(cas) {
            switch(cas) {
                case '1区': return 'bg-blue-100 text-blue-800';
                case '2区': return 'bg-green-100 text-green-800';
                case '3区': return 'bg-yellow-100 text-yellow-800';
                case '4区': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // 设置背景图片
        document.body.style.backgroundImage = "url('https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80')";
        document.body.style.backgroundSize = "cover";
        document.body.style.backgroundAttachment = "fixed";
    </script>
</body>
</html>
